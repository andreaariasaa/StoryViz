<!DOCTYPE html>
<html>

  <head>
    <meta charset="UTF-8" />
    <title>Counting the Causes of Migration</title>
   	<link href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,500" rel="stylesheet">
   	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css">
	  <script src="https://cdnjs.cloudflare.com/ajax/libs/ScrollMagic/2.0.5/ScrollMagic.min.js"></script>
    <script src="https://d3js.org/d3.v3.min.js"></script>
    <style>
      .node {
        stroke-width: 1.5px;
      }
      body {
        background-color: #E4DAC2;
        color: #481F01;
        }

		  p {
			  font-family: 'Open Sans', sans-serif;
			  font-weight:300;
		    }

		  svg {
        width:100%;
        height:600px;
        padding-left:5%;
        padding-right:50px;
		    }

		  h1 {
        font-size:60px;
        font-weight:200;
        line-height:1.3;
		    }

      .callout {
        color: #900D09;
        font-size: 30px;
        transition: opacity 1.2s;
        opacity: 0;
        -webkit-transition: opacity 1.2s;
        }

      .callout2 {
        color: #900D09;
        font-size: 30px;
        transition: opacity 1.2s;
        -webkit-transition: opacity 1.2s;
        }

		  .calloutdiv {
        position: -webkit-sticky;
        position: sticky;
        top: -1px;
        padding: 100px;
        padding-top: 300px;
        transition: opacity 0.8s;
        -webkit-transition: opacity 0.8s;
        text-align: center;
    	  }

      .imagediv {
        position: -webkit-sticky;
        position: sticky;
        top: -1px;
        padding: 50px;
        transition: opacity 0.8s;
        -webkit-transition: opacity 0.8s;
        }

      .img {
        max-width: 100%;
        max-height: 100%;
        position: relative;
        opacity: 0;
        transition: opacity 1.2s;
        -webkit-transition: opacity 1.2s;
        }

      .img2 {
        max-width: 100%;
        max-height: 100%;
        position: relative;
        opacity: 0;
        transition: opacity 1.2s;
        -webkit-transition: opacity 1.2s;
        }

	    .active {
        opacity:1;
    	  }

      .deactive {
        opacity:0;
        }

	  </style>

  </head>

  <body>
    <main role="main" class="container">

      <div class="row">
        <div class="col-6">
          <br><br>
          <h1>Counting the Causes of Migration</h1>
        </div>
      </div>

      <div class="row">
        <div class="col-6">
          <h6>By Andrea Arias, Jimin Lee, and Keili Tucker</h6>
          <hr>
        </div>
      </div>

      <div class="row">

        <div class="col-4">
          <p id="image1-on"> There are many reasons people choose to migrate, and understanding those reasons and those choices help us understand the stories of migrants. This article will be focusing on people from Guatemala, Honduras, and El Salvador and examining desires to migrate, experiences of migration and the factors and causes that impact it.  </p>
          <br><br>
          <p> Let’s begin by looking at all the households that were interviewed as a part of this survey. A note about the survey, it was conducted by the World Food Program in Guatemala, El Salvador, and Honduras. Each dot represents one household since one person per household was interviewed. For more information about the World Food Program, you can go <a href=”https://www.wfp.org/”>here</a> </p>
          <br><br>
          <p id="image1-off"> Our visualization will start with a scrollytelling portion that looks at the household survey responses and will tell a story from the data. We will be looking specifically at income, cost of living, and violence to see how these factors contribute to a desire to move. Obviously this cannot directly state causation, rather we just want to use this as an investigatory tool.</p>
          <br><br>
          <p id="quote1-on"> To begin, we will split our data by income into a couple of main income brackets, based on the groupings in the original survey. From there we can look at the two lowest income brackets and further split their income into portions of income. As many respondents received income from multiple sources, this split will give us a better understanding of how people get their money. </p>
          <br><br>
          <p> We would see this as two new splits among the household dots to best visualize what the background the households are coming from and understand which households we are focusing on. An important part of our visualization is also to narrow at each level. After looking at income, we can further narrow by cost of living.</p>
          <br><br>
          <p id="quote1-off"> We have many questions about cost of living, so we can focus on the questions about cost of housing, important grains, and general cost of food. Now we can focus specifically on households that have lower income and a higher cost of living to see that intersection. </p>
          <br><br>
        </div>

        <div class="col-8">
          <div id="viz"></div>
          <br />
          <br />
          <div class="calloutdiv">
            <p class="callout"> We would see this as two new splits among the household dots </p>
          </div>
        </div>

        <div class="col-4">
          <p id="image2-on">The new visualization could look something like this image. Of course the actual labels for the data would be different and specific to cost of living in this case, but the idea of using dots to visualize the differences between respondents will be the same.</p>
          <br><br>
          <p id="quote2-on"> Our next step would be to add one more level of survey data, this time looking at how these impacts affect desire to migrate. Given the households we are currently looking at, we can split them a couple times. Once to see how many families wanted to move and once to see how many families had tried in the past three years. </p>
          <br><br>
          <p id="image2-off"> From here, we want to make sure that our data visualization doesn’t lose the human element. We use data visualizations to help tell stories about people. The end of the scrollytelling could likely be a case study about a specific household from this group to learn more about the family structure, country of origin, and other traits to help refocus the project.</p>
          <br><br>
          <p id="quote2-off">We may also include maps alongside our project, such as the one below that helps show where significant acts of violence happen across the northern triangle. If we also split the respondents by country, this map could help understand of local violence impacts migration.</p>
          <br><br>
        </div>

        <div class="col-8">
          <div id="viz"></div>
          <div class="calloutdiv">
            <p class="callout2"> We use data visualizations to help tell stories about people.  </p>
          </div>
        </div>

      </div>

      <div class="row">
        <iframe id="igraph" scrolling="no" style="border:none;" seamless="seamless" src="https://plotly.com/~ariasa/1.embed" height="525" width="100%"></iframe>
      </div>

    </main><!-- /.container -->
  </body>

  <script type="text/javascript">

    var controller = new ScrollMagic.Controller();

    new ScrollMagic.Scene({triggerElement: "#image1-on"})
      .setClassToggle(".img", "active")
      .addTo(controller);

    new ScrollMagic.Scene({triggerElement: "#quote1-on"})
      .setClassToggle(".callout", "active")
      .addTo(controller);

		new ScrollMagic.Scene({triggerElement: "#image1-off"})
      .setClassToggle(".img", "deactive")
      .addTo(controller);

    new ScrollMagic.Scene({triggerElement: "#quote1-off"})
      .setClassToggle(".callout", "deactive")
      .addTo(controller);

    new ScrollMagic.Scene({triggerElement: "#image2-on"})
      .setClassToggle(".img2", "active")
      .addTo(controller);

    new ScrollMagic.Scene({triggerElement: "#quote2-on"})
      .setClassToggle(".callout2", "active")
      .addTo(controller);

    new ScrollMagic.Scene({triggerElement: "#image2-off"})
      .setClassToggle(".img2", "deactive")
      .addTo(controller);

    new ScrollMagic.Scene({triggerElement: "#quote2-off"})
      .setClassToggle(".callout2", "deactive")
      .addTo(controller);

    var width = 960,
        height = 500;

    var fill = d3.scale.category10();

    var nodes = d3.range(200).map(function(i) {
      return {index: i};
    });

    var force = d3.layout.force()
        .nodes(nodes)
        .size([width, height])
        .on("tick", tick)
        .start();

    const svg = d3.select("#viz")
              .append("svg")
               .attr("viewBox", [0, 0, width, height])

    var node = svg.selectAll(".node")
        .data(nodes)
      .enter().append("circle")
        .attr("class", "node")
        .attr("cx", function(d) { return d.x; })
        .attr("cy", function(d) { return d.y; })
        .attr("r", 8)
        .style("fill", function(d, i) { return fill(i & 3); })
        .style("stroke", function(d, i) { return d3.rgb(fill(i & 3)).darker(2); })
        .call(force.drag)
        .on("mousedown", function() { d3.event.stopPropagation(); });

    svg.style("opacity", 1e-6)
      .transition()
        .duration(1000)
        .style("opacity", 1);

    d3.select("body")
        .on("mousedown", mousedown);

    function tick(e) {

      // Push different nodes in different directions for clustering.
      var k = 6 * e.alpha;
      nodes.forEach(function(o, i) {
        o.y += i & 1 ? k : -k;
        o.x += i & 2 ? k : -k;
      });

      node.attr("cx", function(d) { return d.x; })
          .attr("cy", function(d) { return d.y; });
    }

    function mousedown() {
      nodes.forEach(function(o, i) {
        o.x += (Math.random() - .5) * 40;
        o.y += (Math.random() - .5) * 40;
      });
      force.resume();
    }

  </script>

</html>
